<!DOCTYPE html>
<html>
  <head>

  </head>
  <body>
    
    <div id="app"></div>

    <script src="https://cdn.bootcss.com/vue/2.6.4/vue.js"></script>
    <!-- 1. å¼•å…¥vue-routerï¼ˆæ ¸å¿ƒæ’ä»¶ï¼‰ -->
    <script src="https://cdn.bootcss.com/vue-router/3.0.2/vue-router.js"></script>

    <script type="text/javascript">

      var isLogin = false
      var Login = {
        template: `<div>
          æ¬¢è¿ç™»å½•...
        </div>`,
        created() {
          isLogin = true
        },
      }

      var Music = {
        template: `<div>
          éŸ³ä¹ç›’å­ğŸµ...
        </div>`
      }
      
      // 2. å®‰è£…æ’ä»¶ =ã€‹ï¼Ÿ
      Vue.use(VueRouter)

      // 3. åˆ›å»ºä¸€ä¸ªè·¯ç”±å¯¹è±¡
      // console.log(VueRouter)
      var router = new VueRouter()

      // å¯ä»¥å¤šæ¬¡çš„è¿½åŠ è·¯ç”±è§„åˆ™ï¼ŒåŠ¨æ€çš„è·å–è·¯ç”±è§„åˆ™
      router.addRoutes([

        // é»˜è®¤é¦–é¡µè·¯ç”±
        {path:'/',redirect:{ name:'login'} },

        {name:'login',path:'/login',component:Login},
        // meta:{isChecked:true}ç»™æœªæ¥è·¯ç”±çš„æƒé™æ§åˆ¶..
        // å…¨å±€è·¯ç”±å®ˆå« æ¥åšå‚ç…§æ¡ä»¶
        { name:'music',path: '/music', component:Music, meta:{
          isChecked:true}} // æ›´ä¸ºçµæ´»ï¼Œå¯ä»¥æ–¹ä¾¿è°ƒç”¨åè¿½åŠ è·¯ç”±è§„åˆ™
      ])

      router.beforeEach((to, from, next) => {
        // console.log(to)
        // console.log(from)
        // next() // ä¸è°ƒç”¨next å°±ä¼šå¡ä½

        // Loginç­‰..æ”¾è¡Œ
        // if(to.name === 'login' || to.path === '/') {
        if(!to.meta.isChecked) {
          next()
        } else {
          if (isLogin) {
            next()
          } else {
            alert('è¯·å…ˆç™»å½•..')

            // é‡å®šå‘ /login
            next({ name:'login' })
          }
          
        }
      })
      
      // 6. æŒ‡å®šè·¯ç”±æ”¹å˜å±€éƒ¨çš„ä½ç½®
      var App = {
        template: `
          <div>
            
            <router-link :to="{ name:'login'}">å»ç™»å½•</router-link>
            <router-link :to="{ name:'music'}">å»éŸ³ä¹ç›’å­ğŸµ</router-link>
          
            <router-view></router-view>
          </div>
        `
      }

      // 5. å°†é…ç½®å¥½çš„è·¯ç”±å¯¹è±¡å…³è”åˆ°vueå®ä¾‹ä¸­
      new Vue({
        el: '#app',
        router: router, // ä¸åŠ è¿™ä¸€æ­¥ï¼Œä¼šå¯¼è‡´è¿è¡Œçš„æ—¶å€™è¯´undefinedå¯¹è±¡ä¸­å–ä¸åˆ°matched
        components: {
          app: App
        },       
        template: '<app/>' // å…¥å£ç»„ä»¶
      })
    </script>
  </body>
</html>